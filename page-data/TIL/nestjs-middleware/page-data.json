{"componentChunkName":"component---src-templates-post-template-js","path":"/TIL/nestjs-middleware","result":{"data":{"markdownRemark":{"id":"c92bab6f-cf2f-5a3d-a183-73059853770c","html":"<h2 id=\"middleware\" style=\"position:relative;\"><a href=\"#middleware\" aria-label=\"middleware permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>middleware</h2>\n<ul>\n<li>미들웨어란 route handler 앞에서 호출되는 함수이다.</li>\n<li>미들웨어 함수는 애플리케이션의 요청-응답 주기 안에서 <code class=\"language-text\">request</code> 와 <code class=\"language-text\">response</code> 객체에 접근할 수 있고, <code class=\"language-text\">next()</code> 미들웨어 함수에 접근 가능하다.</li>\n<li>next 미들웨어 함수는 흔히 <code class=\"language-text\">next</code> 라는 변수 이름으로 나타낸다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8f4cbac164c982e255f45889780a956d/587b0/Middlewares_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.499999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAAtklEQVQY05VQywrCMBDst+gX6L1Hz4JXPfqxatWLtQ8RLdUeilBKfbRN0ozd9AGCRVwYdtjszJDVpJT4t0jzTUczjYgoCnBRgTg9FHU/nHxsTQebnQ3n6H0Y0T7jQoF0VKWhxP2VI7jFuIQR4kcGzjnSrOrj6Rz9oY7eQMdoMitnog0MowSuF8A9XxElz8awSsoYV2C1oCnLdrBYGVgaa5h7q/0ugXbTvAzPmeLKsOuGXXf6dds3295+n/0hZBEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/8f4cbac164c982e255f45889780a956d/8ac56/Middlewares_1.webp 240w,\n/static/8f4cbac164c982e255f45889780a956d/d3be9/Middlewares_1.webp 480w,\n/static/8f4cbac164c982e255f45889780a956d/e46b2/Middlewares_1.webp 960w,\n/static/8f4cbac164c982e255f45889780a956d/dbca2/Middlewares_1.webp 970w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/8f4cbac164c982e255f45889780a956d/8ff5a/Middlewares_1.png 240w,\n/static/8f4cbac164c982e255f45889780a956d/e85cb/Middlewares_1.png 480w,\n/static/8f4cbac164c982e255f45889780a956d/d9199/Middlewares_1.png 960w,\n/static/8f4cbac164c982e255f45889780a956d/587b0/Middlewares_1.png 970w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/8f4cbac164c982e255f45889780a956d/d9199/Middlewares_1.png\"\n          alt=\"middleware_1.png\"\n          title=\"middleware_1.png\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<ul>\n<li>Nest 미들웨어는 기본적으로 express의 미들웨어와 동등하다.</li>\n<li>미들웨어는 어떠한 코드도 실행할 수 있다.</li>\n<li>미들웨어는 요청과 응답 객체를 변경할 수 있다.</li>\n<li>스택에서 다음 미들웨어 함수를 호출한다.</li>\n<li>만약 현재 미들웨어 함수가 요청 응답 사이클의 끝이아니라면, 이 미들웨어 함수는 <code class=\"language-text\">next()</code> 함수를 호출하여 다음 미들웨어 함수에게 제어를 전달한다.</li>\n<li>Nest 에서 커스텀 미들웨어를 구현하기 위해서는 함수로 작성할 수 있고, <code class=\"language-text\">@Injectable()</code> 데코레이터로 장식한 클래스로 구현할 수 있다.</li>\n<li>클래스로 구현하는 경우, 해당 클래스는 <code class=\"language-text\">NestMiddleware</code> 인터페이스의 구현체가 된다.</li>\n<li>함수의 경우에는 어떠한 요구조건이 없다.</li>\n</ul>\n<h3 id=\"class-형-미들웨어\" style=\"position:relative;\"><a href=\"#class-%ED%98%95-%EB%AF%B8%EB%93%A4%EC%9B%A8%EC%96%B4\" aria-label=\"class 형 미들웨어 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Class 형 미들웨어</h3>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Injectable<span class=\"token punctuation\">,</span> NestMiddleware <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Request<span class=\"token punctuation\">,</span> Response <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'express'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">Injectable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoggerMiddleware</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">NestMiddleware</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">use</span><span class=\"token punctuation\">(</span>req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span> res<span class=\"token operator\">:</span> Response<span class=\"token punctuation\">,</span> next<span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Request...'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"dependency-injection\" style=\"position:relative;\"><a href=\"#dependency-injection\" aria-label=\"dependency injection permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dependency injection</h3>\n<ul>\n<li>Nest의 미들웨어는 의존성 주입을 지원한다.</li>\n<li>providers와 controllers와 같이, 미들웨어들은 의존성 주입되어질 수 있고 같은 모듈에서 사용가능하다.</li>\n<li>미들웨어의 주입은 보통 생성자를 통해 수행되어진다.</li>\n</ul>\n<h3 id=\"applying-middleware\" style=\"position:relative;\"><a href=\"#applying-middleware\" aria-label=\"applying middleware permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Applying middleware</h3>\n<ul>\n<li><code class=\"language-text\">@Module()</code> 데코레이터에는 미들웨어가 위치할 곳이 없다.</li>\n<li>대신에, 모듈 클래스의 <code class=\"language-text\">configure()</code> 라는 함수를 사용해서 설정한다.</li>\n<li>미들웨어를 사용하려는 모듈은 반드시 <strong>NestModule 인터페이스를 구현해야한다.</strong></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Module<span class=\"token punctuation\">,</span> NestModule<span class=\"token punctuation\">,</span> MiddlewareConsumer <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> LoggerMiddleware <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./common/middleware/logger.middleware'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> CatsModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./cats/cats.module'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">Module</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>CatsModule<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">NestModule</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Middleware를 포함하려면 NestModule 인터페이스를 구현</span>\n  <span class=\"token comment\">// configure 함수를 사용해 미들웨어를 적용</span>\n  <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span>consumer<span class=\"token operator\">:</span> MiddlewareConsumer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">consumer</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>LoggerMiddleware<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forRoutes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cats'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>위의 예제는 설정한 LoggerMiddleware가 /cats 라우팅 경로에 설정되었다.</li>\n<li>또한, 특정한 HTTP 메소드만 수행되도록 route의 path와 method를 <code class=\"language-text\">forRoutes()</code> 메서드에 설정함으로써 미들웨어의 동작을 제한할 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  Module<span class=\"token punctuation\">,</span>\n  NestModule<span class=\"token punctuation\">,</span>\n  RequestMethod<span class=\"token punctuation\">,</span>\n  MiddlewareConsumer\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> LoggerMiddleware <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./common/middleware/logger.middleware'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> CatsModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./cats/cats.module'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">Module</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>CatsModule<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">NestModule</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span>consumer<span class=\"token operator\">:</span> MiddlewareConsumer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">consumer</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>LoggerMiddleware<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">forRoutes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> path<span class=\"token operator\">:</span> <span class=\"token string\">'cats'</span><span class=\"token punctuation\">,</span> method<span class=\"token operator\">:</span> RequestMethod<span class=\"token punctuation\">.</span><span class=\"token constant\">GET</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// GET 요청으로만 제한</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">configure()</code> 함수는 async/await 을 사용하여 비동기처리를 할 수 있다.</li>\n</ul>\n<h3 id=\"route-wildcards\" style=\"position:relative;\"><a href=\"#route-wildcards\" aria-label=\"route wildcards permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Route wildcards</h3>\n<ul>\n<li>위의 forRoutes()는 패턴 기반 경로 또한 지원한다.</li>\n<li>예를들어, * (asterisk) 를 어떠한 문자들의 조합으로 매칭하기위해서 와일드 카드로써 사용 가능하다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token function\">forRoutes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> path<span class=\"token operator\">:</span> <span class=\"token string\">'ab*cd'</span><span class=\"token punctuation\">,</span> method<span class=\"token operator\">:</span> RequestMethod<span class=\"token punctuation\">.</span><span class=\"token constant\">ALL</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>위의 경로는 abcd, ab_cd, abecd, 등과 매칭이 될 것이다.</li>\n<li>?, +, *, () 문자들을 사용할 수 있으며, 정규 표현식의 부분집합이 될 수 있다.</li>\n<li>하이픈 (-) 과 점(.)은 문자 그대로 문자열 기반 경로로 해석이 된다.</li>\n</ul>\n<h3 id=\"middleware-consumer\" style=\"position:relative;\"><a href=\"#middleware-consumer\" aria-label=\"middleware consumer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Middleware consumer</h3>\n<ul>\n<li>MiddlewareConsumer란 <strong>helper class</strong> 이다.</li>\n<li>MiddlewareConsumer 클래스는 미들웨어를 관리하기 위한 몇 가지의 내장 함수를 제공한다.</li>\n<li>이러한 내장 함수들은 전부 간단하게 <strong>fluent style</strong> 안에서 연결될 수 있다.</li>\n<li>forRoutes() 함수는 single string, multiple strings, RouteInfo 객체, controller class, multiple controller classes (여러 개의 컨트롤러 클래스) 를 취할 수 있다.</li>\n<li>대부분의 경우에, 우리는 콤마로 구분된 컨트롤러들의 리스트를 인자로 전달할 것이다.</li>\n<li>apply() 메서드 또한 단일 미들웨어 또는 다수의 미들웨어를 인자로 전달할 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Module<span class=\"token punctuation\">,</span> NestModule<span class=\"token punctuation\">,</span> MiddlewareConsumer <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> LoggerMiddleware <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./common/middleware/logger.middleware'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> CatsModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./cats/cats.module'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> CatsController <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./cats/cats.controller.ts'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">Module</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>CatsModule<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">NestModule</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span>consumer<span class=\"token operator\">:</span> MiddlewareConsumer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">consumer</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>LoggerMiddleware<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forRoutes</span><span class=\"token punctuation\">(</span>CatsController<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 컨트롤러 or [컨트롤러, 컨트롤러] 등 사용가능</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"excluding-routes\" style=\"position:relative;\"><a href=\"#excluding-routes\" aria-label=\"excluding routes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Excluding routes</h3>\n<ul>\n<li>때때로, 우리는 미들웨어가 적용되는 특정 경로를 제외하기를 원할 때가 있다.</li>\n<li>exclude() 메서드를 사용하면 쉽게 특정 경로를 제외할 수 있다.</li>\n<li>이 메서드 또한 단일 문자열, 여러개의 문자열, 제외되어질 경로를 나타내는 RouteInfo 객체 가 올 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token function\">consumer</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>LoggerMiddleware<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">exclude</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">{</span> path<span class=\"token operator\">:</span> <span class=\"token string\">'cats'</span><span class=\"token punctuation\">,</span> method<span class=\"token operator\">:</span> RequestMethod<span class=\"token punctuation\">.</span><span class=\"token constant\">GET</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 이게 RouteInfo 객체</span>\n    <span class=\"token punctuation\">{</span> path<span class=\"token operator\">:</span> <span class=\"token string\">'cats'</span><span class=\"token punctuation\">,</span> method<span class=\"token operator\">:</span> RequestMethod<span class=\"token punctuation\">.</span><span class=\"token constant\">POST</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'cats/(.*)'</span> <span class=\"token comment\">// 패턴이 올 수도 있음</span>\n  <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">forRoutes</span><span class=\"token punctuation\">(</span>CatsController<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"functional-middleware\" style=\"position:relative;\"><a href=\"#functional-middleware\" aria-label=\"functional middleware permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Functional middleware</h3>\n<ul>\n<li>class 형태의 미들웨어 뿐만아니라 functional 미들웨어도 작성 가능하다.</li>\n<li>미들웨어가 어떠한 의존성도 없을 경우에 functional 미들웨어를 사용하는 것을 고려해보라고 힌트가 적혀있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// logger.middleware.ts</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Request<span class=\"token punctuation\">,</span> Response <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'express'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">logger</span><span class=\"token punctuation\">(</span>req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span> res<span class=\"token operator\">:</span> Response<span class=\"token punctuation\">,</span> next<span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Request...'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// app.module.ts</span>\n\n<span class=\"token function\">consumer</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forRoutes</span><span class=\"token punctuation\">(</span>CatsController<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"multiple-middleware\" style=\"position:relative;\"><a href=\"#multiple-middleware\" aria-label=\"multiple middleware permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Multiple middleware</h3>\n<ul>\n<li>우리가 기대하는 순서대로, 여러개의 미들웨어를 바인딩 하기위해서는 콤마로 구분된 리스트를 apply() 메서드 안에 나열하면 된다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token function\">consumer</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token function\">cors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">helmet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> logger<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forRoutes</span><span class=\"token punctuation\">(</span>CatsController<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"global-middleware\" style=\"position:relative;\"><a href=\"#global-middleware\" aria-label=\"global middleware permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Global middleware</h3>\n<ul>\n<li>만약 모든 경로에 미들웨어를 한번에 등록하고 싶다면, INestApplication 인스턴스에 의해 제공되는 <strong>use()</strong> 메서드를 사용하여 미들웨어를 등록하면 된다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> NestFactory<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>AppModule<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">await</span> app<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h3>\n<p><a href=\"https://docs.nestjs.com/middleware\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Documentation | NestJS - A progressive Node.js framework</a></p>","fields":{"slug":"/TIL/nestjs-middleware","tagSlugs":["/tag/nest-js/","/tag/framework/","/tag/middleware/"]},"frontmatter":{"date":"2020-12-08T22:00:00.000Z","description":"NestJS 공식문서 Overview - Middleware를 정리한 내용입니다.","tags":["NestJS","Framework","Middleware"],"title":"NestJS - Middleware","socialImage":null}}},"pageContext":{"slug":"/TIL/nestjs-middleware"}},"staticQueryHashes":["251939775","3942705351","401334301"]}